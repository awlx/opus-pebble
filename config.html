<!DOCTYPE HTML>
<html>

<head>
    <link rel="stylesheet" href="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.blue-red.min.css" />
    <script src="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style type="text/css">
        .demo-card-wide {
            margin: 20px auto 40px;
        }

        #feedback {
            text-align: right;
            float: right;
        }

        .mdl-tooltip {
            z-index: 1000;
        }

        .has-tt {
            z-index: 1000;
            position: relative;
        }
    </style>
    <!-- start Mixpanel -->
    <script type="text/javascript">
        (function (e, b) {
            if (!b.__SV) {
                var a, f, i, g;
                window.mixpanel = b;
                b._i = [];
                b.init = function (a, e, d) {
                    function f(b, h) {
                        var a = h.split(".");
                        2 == a.length && (b = b[a[0]], h = a[1]);
                        b[h] = function () {
                            b.push([h].concat(Array.prototype.slice.call(arguments, 0)))
                        }
                    }
                    var c = b;
                    "undefined" !== typeof d ? c = b[d] = [] : d = "mixpanel";
                    c.people = c.people || [];
                    c.toString = function (b) {
                        var a = "mixpanel";
                        "mixpanel" !== d && (a += "." + d);
                        b || (a += " (stub)");
                        return a
                    };
                    c.people.toString = function () {
                        return c.toString(1) + ".people (stub)"
                    };
                    i = "disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
                    for (g = 0; g < i.length; g++) f(c, i[g]);
                    b._i.push([a, e, d])
                };
                b.__SV = 1.2;
                a = e.createElement("script");
                a.type = "text/javascript";
                a.async = !0;
                a.src = "undefined" !== typeof MIXPANEL_CUSTOM_LIB_URL ? MIXPANEL_CUSTOM_LIB_URL : "file:" === e.location.protocol && "//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//) ? "https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js" : "//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";
                f = e.getElementsByTagName("script")[0];
                f.parentNode.insertBefore(a, f)
            }
        })(document, window.mixpanel || []);
        mixpanel.init("6229cfb42de97ef516b9da89c4f96ac1");
    </script>
    <!-- end Mixpanel -->
</head>

<body>
    <div class="demo-card-wide mdl-card mdl-shadow--2dp">
        <div class="mdl-card__title">
            <h2 class="mdl-card__title-text">Opus Settings for Kodi</h2>
        </div>
        <form id="form">
            <div class="mdl-card__supporting-text">
                Configure Opus here.
                <br /> Then confirm your changes with the "Save" button.
            </div>
            <div class="mdl-card__supporting-text">
                <fieldset class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="tel" id="ip" name="ip" required="required">
                    <label class="mdl-textfield__label" for="ip">Kodi IP Address</label>
                    <span class="mdl-textfield__error">Enter Kodi's local IP address</span>
                </fieldset>
            </div>
            <div class="mdl-card__supporting-text">
                <fieldset id="tt1" class="has-tt">
                    <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-update-ui">
                        <input type="checkbox" id="switch-update-ui" class="mdl-switch__input" checked>
                        <span class="mdl-switch__label">Regularly update UI</span>
                        <div for="tt1" class="mdl-tooltip mdl-tooltip--large">
                            Query Kodi a few times per minute for its current state.
                        </div>
                    </label>
                </fieldset>
            </div>
            <div class="mdl-card__supporting-text">
                <fieldset>
                    <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-vibe-long-press">
                        <input type="checkbox" id="switch-vibe-long-press" class="mdl-switch__input" checked>
                        <span class="mdl-switch__label">Vibrate on long press</span>
                    </label>
                </fieldset>
            </div>
            <div class="mdl-card__supporting-text">
                <fieldset>
                    <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-show-clock">
                        <input type="checkbox" id="switch-show-clock" class="mdl-switch__input" checked>
                        <span class="mdl-switch__label">Show clock line with current time</span>
                    </label>
                </fieldset>
            </div>
            <div class="mdl-card__actions mdl-card--border">
                <button type="submit" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
                    Save
                </button>
                <p id="feedback"></p>
            </div>
        </form>
    </div>
    <span id="log"></span>


    <script type="text/javascript">
        (function () {
            var config;

            document.getElementById('form').addEventListener('submit', function (event) {
                event.preventDefault();
                event.stopPropagation();

                var settings = {
                    ip: document.getElementById('ip').value.trim(),
                    vibeOnLongPress: document.getElementById('switch-vibe-long-press').checked,
                    updateUi: document.getElementById('switch-update-ui').checked,
                    showClock: document.getElementById('switch-show-clock').checked
                };

                log('Saved.<br />' + JSON.stringify(settings) + '<br/>' + encodeURIComponent(JSON.stringify(settings)));

                mixpanel.track("Config saved", settings);

                setTimeout(function() {
                    document.location = 'pebblejs://close#' + encodeURIComponent(JSON.stringify(settings));
                }, 300);
            });

            function log(text) {
                setTimeout(function() {
                    document.getElementById('log').innerHTML = text;
                }, 1000);
            }

            (function init() {
                try {
                    config = JSON.parse(decodeURIComponent(window.location.hash.substr(1)));
                    mixpanel.identify(config.uid);
                    document.getElementById('ip').value = config.ip || '';
                    document.getElementById('switch-vibe-long-press').checked = config.vibeOnLongPress;
                    document.getElementById('switch-update-ui').checked = config.updateUi;
                    document.getElementById('switch-show-clock').checked = config.showClock;
                } catch (e) {
                    document.getElementById('switch-vibe-long-press').checked = true;
                    document.getElementById('switch-update-ui').checked = true;
                    document.getElementById('switch-show-clock').checked = false;

                    mixpanel.track("Config, Parsing error", {
                        detectedHash: decodeURIComponent(window.location.hash.substr(1))
                    });

                    log('Could not parse current configuration.');
                }
                mixpanel.track("Config viewed");
            })();
        })();
    </script>
</body>

</html>
